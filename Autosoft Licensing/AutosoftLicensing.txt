AutoSoft Licensing — Corrected Project Description (DEALER & CLIENT DLL)
One-line summary

AutoSoft Licensing implements the dealer-side license generator (EXE) and the client-side License UI library (DLL) used by AutoCount plugins. The dealer EXE is used by Autosoft staff to generate .ASL license files from customer .ARL requests. The client DLL is embedded by plugin projects to build .ARL requests and import/validate .ASL activation files.

Important: You are not building the AutoCount plugin itself. The plugin developers will integrate the DLL into their plugins. The AutoCount plugin and any payment/approval flows are out of scope.

High-level deliverables (what you implement)

License Generator Application (Dealer EXE) — Windows Forms application (DevExpress allowed).

Loads .ARL files created by customers, validates them, builds license payloads, computes checksum, encrypts and outputs .ASL.

Admin UI: generate license, view license records, manage products/modules, manage dealer users/roles.

Stores dealer-side metadata (local DB). Keeps private key/secret in dealer environment (never exported).

License UI Library (Client DLL) — Class Library (.dll) used inside AutoCount plugins.

Provides UserControls / API for: Save Request File (.ARL), Register By File (.ASL), View License Info.

Creates canonical .ARL JSON, exports to file. Imports .ASL, Base64-decodes, decrypts, verifies checksum, validates fields and machine/product binding, persists license metadata locally (encrypted).

Public API for plugin developers: create/initialize license control, show license UI, identify license, query validity.

Shared Contracts Library (optional small project)

Shared DTOs (.ARL, .ASL payload models) and canonical JSON serializer used by both EXE and DLL to prevent checksum mismatch.

Reference file for design / inspiration: /mnt/data/iFlexiHRMS License Control.docx

Architecture & Tech stack

Language: C#

Platform: .NET Framework 4.8

UI: DevExpress WinForms. Dealer EXE uses DevExpress.XtraEditors.XtraForm as main window with left navigation (Accordion/NavBar) and PanelControl/NavigationFrame to load UserControls. The DLL exposes DevExpress UserControls to be embedded by plugins.

Storage: Local SQL Server (or SQLite for lightweight deployment) for Dealer EXE. Client DLL persists minimal encrypted license metadata per plugin (file or registry).

Security: AES-256 (CBC) for encryption + SHA-256 for tamper-proof checksum. Use a canonical JSON serialization (deterministic property ordering, UTF-8) for checksum calculation.

Files & formats (contracts)
.ARL — Autosoft Request License (customer → dealer)

Plain JSON (UTF-8). Must contain required fields:

{
  "CompanyName":"string",
  "ProductID":"string",
  "DealerCode":"string",
  "RequestedPeriodMonths":12,
  "LicenseType":"Demo|Subscription|Permanent",
  "LicenseKey":"string",
  "CurrencyCode":"string|null",
  "MachineFingerprint":"string|null",
  "RequestDateUtc":"ISO8601 UTC"
}


Validation failure → return exact message: "Invalid license request file."

.ASL — Autosoft Solution License (dealer → customer)

Encrypted + encoded: Base64( IV + AES256_CBC(UTF8( JSON_WITH_CHECKSUM ) ) ).
Decrypted JSON payload:

{
  "CompanyName":"string",
  "ProductID":"string",
  "DealerCode":"string",
  "CurrencyCode":"string|null",
  "LicenseType":"Demo|Subscription|Permanent",
  "ValidFromUtc":"ISO8601 UTC",
  "ValidToUtc":"ISO8601 UTC",
  "LicenseKey":"string",
  "AllowedModules":["ModuleA","ModuleB"],
  "MachineFingerprint":"string|null",
  "ChecksumSHA256":"hex-lowercase"
}


Decrypt / checksum failure → exact message: "Invalid or tampered license file."

Base64/decode error or unsupported format → "Invalid license file."

Expired license → "License expired." (if demo expired show "Demo license expired." and plugin should hide features).

Canonicalization note: both EXE and DLL must use the same canonical JSON serializer (alphabetical names, no insignificant whitespace, UTF-8) before computing SHA-256.

Business rules (concise)

Supported license types:

Demo — fixed 1 month from issuance.

Subscription — allowed durations: 3, 6, 12, 24 months; default 12 months in UI. Admin may adjust duration manually.

Permanent — optional/perpetual; admin-set.

Renewals & payments are handled outside this system (manual).

License validation must run on every AutoCount login (plugin authors call into DLL to check).

No persistent audit logs are required (transient UI-only error messages).

UI: Pages & responsibilities (Dealer EXE) — summary

Implement these as UserControls hosted in MainForm:

Login — Dealer user authentication (local user DB).

Generate License (core) — upload .ARL, auto-fill fields, pick license type/duration/modules, generate license key, preview payload, Download .ASL.

Enforce Demo = 1 month.

License Records — filterable grid of generated licenses + countdown to expiry; row color-coded.

License Details / Edit — view full payload; Admin can extend expiry or modify modules (stored in DB).

Manage Product — CRUD Product & module definitions (used by generator).

Manage User — local Dealer user accounts and role permissions (Generate License, Manage Product, View Records, Manage Users). Prevent deleting default Admin.

Settings — Key/IV config (dev/testing only; TODO: secure provisioning), toggle raw file storage, default save folder.

Help / About / Logout

Client DLL pages (embedded in plugin — separate project):

License Entry — Save Request File (.ARL) and Register by File (.ASL). Must accept productId, productName, companyName, and optionally a machine fingerprint from the plugin host.

License Info — show currently persisted license metadata and allow removal/re-register actions.

Services & public APIs (recommended interfaces)

IUserService — Dealer user CRUD & authentication.

IArlService — parse & validate .ARL.

IAslService — build .ASL payload, compute checksum, encrypt & write file.

ILicenseService — import .ASL, decrypt, validate, persist license (Dealer DB or client local store).

ILicenseDatabaseService — DB CRUD for Licenses and Requests.

IEncryptionService — AES encrypt/decrypt + SHA-256 compute.

IMachineFingerprintProvider (DLL) — plugin-provided implementer to supply machine/account fingerprint.

DLL public API example (minimal):

ILicenseControl License.Create(string productId, string productName);
interface ILicenseControl {
  void Initialize(string companyName, IMachineFingerprintProvider fp);
  bool IdentifyLicense();
  bool IsValidLicense();
  LicenseInfo GetLicenseInfo();
  DialogResult ShowLicenseUi(Form parent);
  string SaveArl(string outputPath);
  ImportResult ImportAsl(string path);
}

Persistence

Dealer EXE: local SQL Server recommended (tables: Licenses, LicenseRequests, Products, Users). Raw ASL storage optional (encrypt before storing).

Client DLL: local encrypted file or registry entry storing minimal license metadata (Company, ProductID, ValidFrom/To, LicenseKey, AllowedModules). Keep it small and private.

Error messages (exact strings)

Use these exact strings so UI/backend are consistent with requirements:

"Invalid license request file."

"Invalid license file."

"Invalid or tampered license file."

"License expired."

"Demo license expired."

"License generated successfully." (dealer EXE success)

"License imported successfully." (DLL success)

Out-of-scope (clear)

AutoCount plugin code (other developers integrate the DLL).

Payment processing, automatic renewal, or central license servers.

AutoCount internals (DLL will be given company/product values by plugin host; DO NOT query AutoCount DB directly inside your EXE/DLL).

Secure key provisioning / HSM integration (mark as TODO; for prototype use DPAPI / local protected storage).

Developer & Copilot guidance (short prompts to insert in files)

Add these short comment prompts at top of key source files to steer Copilot:

EncryptionService.cs

// Implement AES-256-CBC encrypt/decrypt with random IV. Prepend IV to ciphertext before Base64.
// Compute SHA256 checksum of canonical JSON (without ChecksumSHA256).


ArlService.cs (DLL)

// Build ARL JSON using provided productId, companyName, machineFingerprint and requested months.
// Validate required fields. Save UTF-8 .ARL to disk.


AslService.cs (EXE)

// Read ARL, build ASL payload, compute checksum, AES encrypt (AES-256), then Base64 encode and save .ASL.


LicenseControlFactory.cs (DLL)

// Provide public API Create(productId, productName) returning ILicenseControl used by plugin.

Acceptance checklist (smoke/QA)

EXE accepts .ARL and produces .ASL that the DLL can decrypt and validate (roundtrip).

DLL creates .ARL accepted by EXE.

Demo licenses set to exactly 1 month; Subscription defaults to 12 months (UI allows 3/6/12/24).

DLL IsValidLicense() returns false for expired licenses and returns the correct messages.

Error messages match exact strings above.

Reference

Instructor sample / reference doc: /mnt/data/iFlexiHRMS License Control.docx — review for compatibility and ideas.